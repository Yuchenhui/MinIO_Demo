<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<properties>
	<parsers>     
        <parser class="org.apache.tika.parser.ocr.TesseractOCRParser"/>   
		<parser class="org.apache.tika.parser.DefaultParser">
			<mime-exclude>application/pdf</mime-exclude>
			<parser-exclude class="org.apache.tika.parser.executable.ExecutableParser"/>
			<parser-exclude class="org.apache.tika.parser.ocr.TesseractOCRParser"/>
			<parser-exclude class="org.apache.tika.parser.pdf.PDFParser"/>
			<parser-exclude class="org.apache.tika.parser.microsoft.ooxml.OOXMLParser"/>
			<parser-exclude class="org.apache.tika.parser.microsoft.OfficeParser"/>
		</parser>
        <parser class="org.apache.tika.parser.pdf.PDFParser">
			<mime>application/pdf</mime>
            <params>
                <!-- no_ocr - extract text only
                     ocr_only - don't extract text and just attempt OCR
                     ocr_and_text - extract text and attempt OCR (from Tika 1.24)
                     auto - extract text but if < 10 characters try OCR
                -->
                <param name="ocrStrategy" type="string">ocr_and_text</param>
                <param name="ocrImageType" type="string">rgb</param>
                <param name="ocrDPI" type="int">100</param>
				<param name="extractInlineImages" type="bool">true</param>
				<param name="extractActions" type="bool">true</param>
				<param name="checkExtractAccessPermissions" type="bool">true</param>
            </params>
        </parser>
		<parser class="org.apache.tika.parser.microsoft.ooxml.OOXMLParser">
		  <params>
			<param name="includeDeletedContent" type="bool">true</param>
			<param name="includeMoveFromContent" type="bool">true</param>
			<param name="extractMacros" type="bool">true</param>
		  </params>
		</parser>
		<parser class="org.apache.tika.parser.microsoft.OfficeParser">
		  <params>
			<param name="extractMacros" type="bool">true</param>
		  </params>
		</parser>
	</parsers>
	<fetchers>
        <fetcher class="org.apache.tika.pipes.fetcher.http.HttpFetcher">
            <params>
                <name>http</name>
            </params>
        </fetcher>
		<fetcher class="org.apache.tika.pipes.fetcher.fs.FileSystemFetcher">
		  <params>
			<name>fsf</name>
			<basePath>/var/tika/docs</basePath>
		  </params>
		</fetcher>
    </fetchers>
	<emitters>
		<emitter class="org.apache.tika.pipes.emitter.fs.FileSystemEmitter">
		  <params>
			<name>fse</name>
			<basePath>/var/tika/extracts</basePath>
		  </params>
		</emitter>
		<emitter class="org.apache.tika.pipes.emitter.opensearch.OpenSearchEmitter">
		  <params>
			<name>ose</name>
			<openSearchUrl>http://192.168.50.184:9200/minio</openSearchUrl>
			<attachmentStrategy>PARENT_CHILD</attachmentStrategy>
			<commitWithin>10</commitWithin>
			<idField>_id</idField>
			<connectionTimeout>10000</connectionTimeout>
			<socketTimeout>60000</socketTimeout>
		  </params>
		</emitter> 
	</emitters>
	<pipesIterator class="org.apache.tika.pipes.pipesiterator.fs.FileSystemPipesIterator">
		<params>
		  <fetcherName>fsf</fetcherName>
		  <emitterName>fse</emitterName>
		  <basePath>/var/tika/docs</basePath>
		</params>
	</pipesIterator>
	<server>
	  <params>
		<enableUnsecureFeatures>true</enableUnsecureFeatures>
	  </params>
	</server>
	<async>
		<params>
		  <maxForEmitBatchBytes>1000000</maxForEmitBatchBytes>
		  <emitMaxEstimatedBytes>10000000</emitMaxEstimatedBytes>
		  <emitWithinMillis>60000</emitWithinMillis>
		  <numEmitters>1</numEmitters>
		  <numClients>10</numClients>
		  <tikaConfig>tika-config.xml</tikaConfig>
		  <forkedJvmArgs>
			<arg>-Xmx1g</arg>
			<arg>-XX:ParallelGCThreads=2</arg>
			<arg>-Dlog4j.configurationFile=file:log4j2-async.xml</arg>
		  </forkedJvmArgs>
		  <timeoutMillis>120000</timeoutMillis>
		</params>
	</async>
	<pipes>
		<params>
		  <tikaConfig>tika-config.xml</tikaConfig>
		</params>
	</pipes>
	<metadataFilters>
            <!-- depending on the file format, some dates do not have a timezone. This
                 filter arbitrarily assumes dates have a UTC timezone and will format all
                 dates as yyyy-MM-dd'T'HH:mm:ss'Z' whether or not they actually have a timezone.
                 Note: this needs to come before fields are renamed!
             -->
        <metadataFilter class="org.apache.tika.metadata.filter.DateNormalizingMetadataFilter"/> 
        <metadataFilter class="org.apache.tika.metadata.filter.FieldNameMappingFilter">
            <params>
                <excludeUnmapped>true</excludeUnmapped>
                <mappings>
                    <mapping from="X-TIKA:content" to="content"/>
                    <mapping from="Content-Length" to="length"/>
                    <mapping from="dc:creator" to="creators"/>
                    <mapping from="dcterms:created" to="created"/>
                    <mapping from="dc:title" to="title"/>
                    <mapping from="Content-Type" to="mime"/>
                    <mapping from="X-TIKA:EXCEPTION:container_exception" to="tika_exception"/>
                    <mapping from="X-TIKA:embedded_resource_path" to="embedded_path"/>
                    <mapping from="resourceName" to="resource_name"/>
                    <mapping from="X-TIKA:embedded_depth" to="embedded_depth"/>
                </mappings>
            </params>
        </metadataFilter>
    </metadataFilters>
	
</properties>
